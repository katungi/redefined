// Theme definitions using shadcn color palettes
export const colorThemes = {
    default: {
        light: {
            colorBackgroundBottom: '#feffff',
            colorBackgroundTop: '#fdffff',
            colorEmphasized: '#1170d0',
            colorSecondary: '#789dc7',
            colorForeground: '#283556',
            colorForegroundExtra: '#142842',
            colorMedium: '#789dc7',
            colorSubtle: '#d7e9ef',
        },
        dark: {
            colorBackgroundBottom: '#111117',
            colorBackgroundTop: '#071428',
            colorEmphasized: '#77bbff',
            colorSecondary: '#789dc7',
            colorForeground: '#dae7f3',
            colorForegroundExtra: '#e5edf3',
            colorMedium: '#789dc7',
            colorSubtle: '#052438',
        }
    },
    bubblegum: {
        light: {
            colorBackgroundBottom: 'oklch(0.9399 0.0203 345.6985)',
            colorBackgroundTop: 'oklch(0.9498 0.0500 86.8891)',
            colorEmphasized: 'oklch(0.6209 0.1801 348.1385)',
            colorSecondary: 'oklch(0.8095 0.0694 198.1863)',
            colorForeground: 'oklch(0.4712 0 0)',
            colorForegroundExtra: 'oklch(0.3211 0 0)',
            colorMedium: 'oklch(0.5795 0 0)',
            colorSubtle: 'oklch(0.8800 0.0504 212.0952)',
        },
        dark: {
            colorBackgroundBottom: 'oklch(0.2497 0.0305 234.1628)',
            colorBackgroundTop: 'oklch(0.2902 0.0299 233.5352)',
            colorEmphasized: 'oklch(0.9195 0.0801 87.6670)',
            colorSecondary: 'oklch(0.7794 0.0803 4.1330)',
            colorForeground: 'oklch(0.9306 0.0197 349.0785)',
            colorForegroundExtra: 'oklch(0.9306 0.0197 349.0785)',
            colorMedium: 'oklch(0.7794 0.0803 4.1330)',
            colorSubtle: 'oklch(0.2713 0.0086 255.5780)',
        }
    },
    catpuccin: {
        light: {
            colorBackgroundBottom: 'oklch(0.9578 0.0058 264.5321)',
            colorBackgroundTop: 'oklch(1.0000 0 0)',
            colorEmphasized: 'oklch(0.5547 0.2503 297.0156)',
            colorSecondary: 'oklch(0.6820 0.1448 235.3822)',
            colorForeground: 'oklch(0.4355 0.0430 279.3250)',
            colorForegroundExtra: 'oklch(0.4355 0.0430 279.3250)',
            colorMedium: 'oklch(0.5471 0.0343 279.0837)',
            colorSubtle: 'oklch(0.9060 0.0117 264.5071)',
        },
        dark: {
            colorBackgroundBottom: 'oklch(0.2155 0.0254 284.0647)',
            colorBackgroundTop: 'oklch(0.2429 0.0304 283.9110)',
            colorEmphasized: 'oklch(0.7871 0.1187 304.7693)',
            colorSecondary: 'oklch(0.8467 0.0833 210.2545)',
            colorForeground: 'oklch(0.8787 0.0426 272.2767)',
            colorForegroundExtra: 'oklch(0.8787 0.0426 272.2767)',
            colorMedium: 'oklch(0.7510 0.0396 273.9320)',
            colorSubtle: 'oklch(0.2973 0.0294 276.2144)',
        }
    },
    softpop: {
        light: {
            colorBackgroundBottom: 'oklch(0.9789 0.0082 121.6272)',
            colorBackgroundTop: 'oklch(1.0000 0 0)',
            colorEmphasized: 'oklch(0.5106 0.2301 276.9656)',
            colorSecondary: 'oklch(0.7038 0.1230 182.5025)',
            colorForeground: 'oklch(0 0 0)',
            colorForegroundExtra: 'oklch(0 0 0)',
            colorMedium: 'oklch(0.3211 0 0)',
            colorSubtle: 'oklch(0.9551 0 0)',
        },
        dark: {
            colorBackgroundBottom: 'oklch(0 0 0)',
            colorBackgroundTop: 'oklch(0.2455 0.0217 257.2823)',
            colorEmphasized: 'oklch(0.6801 0.1583 276.9349)',
            colorSecondary: 'oklch(0.7845 0.1325 181.9120)',
            colorForeground: 'oklch(1.0000 0 0)',
            colorForegroundExtra: 'oklch(1.0000 0 0)',
            colorMedium: 'oklch(0.8452 0 0)',
            colorSubtle: 'oklch(0.3211 0 0)',
        }
    },
    t3: {
        light: {
            colorBackgroundBottom: 'oklch(0.9754 0.0084 325.6414)',
            colorBackgroundTop: 'oklch(1.0000 0 0)',
            colorEmphasized: 'oklch(0.5316 0.1409 355.1999)',
            colorSecondary: 'oklch(0.8696 0.0675 334.8991)',
            colorForeground: 'oklch(0.3257 0.1161 325.0372)',
            colorForegroundExtra: 'oklch(0.3257 0.1161 325.0372)',
            colorMedium: 'oklch(0.4924 0.1244 324.4523)',
            colorSubtle: 'oklch(0.9395 0.0260 331.5454)',
        },
        dark: {
            colorBackgroundBottom: 'oklch(0.2409 0.0201 307.5346)',
            colorBackgroundTop: 'oklch(0.2803 0.0232 307.5413)',
            colorEmphasized: 'oklch(0.4607 0.1853 4.0994)',
            colorSecondary: 'oklch(0.3137 0.0306 310.0610)',
            colorForeground: 'oklch(0.8398 0.0387 309.5391)',
            colorForegroundExtra: 'oklch(0.8456 0.0302 341.4597)',
            colorMedium: 'oklch(0.7940 0.0372 307.1032)',
            colorSubtle: 'oklch(0.2634 0.0219 309.4748)',
        }
    },
    vercel: {
        light: {
            colorBackgroundBottom: 'oklch(0.9900 0 0)',
            colorBackgroundTop: 'oklch(1 0 0)',
            colorEmphasized: 'oklch(0 0 0)',
            colorSecondary: 'oklch(0.9400 0 0)',
            colorForeground: 'oklch(0 0 0)',
            colorForegroundExtra: 'oklch(0 0 0)',
            colorMedium: 'oklch(0.4400 0 0)',
            colorSubtle: 'oklch(0.9700 0 0)',
        },
        dark: {
            colorBackgroundBottom: 'oklch(0 0 0)',
            colorBackgroundTop: 'oklch(0.1400 0 0)',
            colorEmphasized: 'oklch(1 0 0)',
            colorSecondary: 'oklch(0.2500 0 0)',
            colorForeground: 'oklch(1 0 0)',
            colorForegroundExtra: 'oklch(1 0 0)',
            colorMedium: 'oklch(0.7200 0 0)',
            colorSubtle: 'oklch(0.2300 0 0)',
        }
    }
} as const;

export type ThemeName = keyof typeof colorThemes;
export type ColorMode = 'light' | 'dark';

export class ThemeManager {
    private currentTheme: ThemeName = 'default';
    private currentMode: ColorMode = 'light';
    private listeners: Array<(theme: ThemeName, mode: ColorMode) => void> = [];

    constructor() {
        this.initializeTheme();
    }

    private initializeTheme() {
        if (typeof window === 'undefined') return;

        // Get saved theme from localStorage
        const savedTheme = localStorage.getItem('colorTheme') as ThemeName;
        if (savedTheme && colorThemes[savedTheme]) {
            this.currentTheme = savedTheme;
        }

        // Get current mode from document
        this.currentMode = document.documentElement.classList.contains('dark') ? 'dark' : 'light';

        this.applyTheme();

        // Listen for theme toggle changes
        const observer = new MutationObserver(() => {
            const newMode = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            if (newMode !== this.currentMode) {
                this.currentMode = newMode;
                this.applyTheme();
            }
        });

        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['class']
        });
    }

    setTheme(themeName: ThemeName) {
        this.currentTheme = themeName;
        localStorage.setItem('colorTheme', themeName);
        this.applyTheme();

        // Notify listeners
        this.listeners.forEach(listener => listener(themeName, this.currentMode));

        // Dispatch custom event for other components to listen to
        window.dispatchEvent(new CustomEvent('themeChanged', {
            detail: { theme: themeName, mode: this.currentMode }
        }));
    }

    private applyTheme() {
        if (typeof window === 'undefined') return;

        const themeColors = colorThemes[this.currentTheme][this.currentMode];
        const root = document.documentElement;

        // Apply theme colors to CSS custom properties
        Object.entries(themeColors).forEach(([key, value]) => {
            root.style.setProperty(`--${key}`, value);
        });

        // Update derived CSS variables that depend on theme colors
        root.style.setProperty('--textShadow', `3px 3px 1px ${themeColors.colorSubtle}`);
    }

    getCurrentTheme(): ThemeName {
        return this.currentTheme;
    }

    getCurrentMode(): ColorMode {
        return this.currentMode;
    }

    getAvailableThemes(): ThemeName[] {
        return Object.keys(colorThemes) as ThemeName[];
    }

    addListener(listener: (theme: ThemeName, mode: ColorMode) => void) {
        this.listeners.push(listener);
    }

    removeListener(listener: (theme: ThemeName, mode: ColorMode) => void) {
        this.listeners = this.listeners.filter(l => l !== listener);
    }
}

// Global theme manager instance
export const themeManager = new ThemeManager(); 